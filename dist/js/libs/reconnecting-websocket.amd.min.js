define("index",["require","exports"],function(e,n){"use strict";var o=function(e){return e&&2===e.CLOSING},t=function(){return"undefined"!=typeof WebSocket&&o(WebSocket)},r=function(){return{constructor:t()?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1}},c=function(e,n,o){Object.defineProperty(n,o,{get:function(){return e[o]},set:function(n){e[o]=n},enumerable:!0,configurable:!0})},i=function(e){return e.minReconnectionDelay+Math.random()*e.minReconnectionDelay},s=function(e,n){var o=n*e.reconnectionDelayGrowFactor;return o>e.maxReconnectionDelay?e.maxReconnectionDelay:o},a=["onopen","onclose","onmessage","onerror"],u=function(e,n,o){Object.keys(o).forEach(function(n){o[n].forEach(function(o){var t=o[0],r=o[1];e.addEventListener(n,t,r)})}),n&&a.forEach(function(o){e[o]=n[o]})},l=function(e,n,t){var a=this;void 0===t&&(t={});var f,d,v=0,y=0,m=!0,E=null,h={};if(!(this instanceof l))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var p=r();if(Object.keys(p).filter(function(e){return t.hasOwnProperty(e)}).forEach(function(e){return p[e]=t[e]}),!o(p.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var R=p.debug?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return console.log.apply(console,["RWS:"].concat(e))}:function(){},b=function(e,n){return setTimeout(function(){var o=new Error(n);o.code=e,Array.isArray(h.error)&&h.error.forEach(function(e){return(0,e[0])(o)}),f.onerror&&f.onerror(o)},0)},D=function(){R("handleClose",{shouldRetry:m}),R("retries count:",++y),y>p.maxRetries?b("EHOSTDOWN","Too many failed connection attempts"):(v=v?s(p,v):i(p),R("handleClose - reconnectDelay:",v),m&&setTimeout(L,v))},L=function(){if(m){R("connect");var o=f,t="function"==typeof e?e():e;f=new p.constructor(t,n),d=setTimeout(function(){R("timeout"),f.close(),b("ETIMEDOUT","Connection timeout")},p.connectionTimeout),R("bypass properties");for(var r in f)["addEventListener","removeEventListener","close","send"].indexOf(r)<0&&c(f,a,r);f.addEventListener("open",function(){clearTimeout(d),R("open"),v=i(p),R("reconnectDelay:",v),y=0}),f.addEventListener("close",D),u(f,o,h),f.onclose=f.onclose||E,E=null}};R("init"),L(),this.close=function(e,n,o){void 0===e&&(e=1e3),void 0===n&&(n="");var t=void 0===o?{}:o,r=t.keepClosed,c=void 0!==r&&r,i=t.fastClose,s=void 0===i||i,a=t.delay,u=void 0===a?0:a;if(R("close - params:",{reason:n,keepClosed:c,fastClose:s,delay:u,retriesCount:y,maxRetries:p.maxRetries}),m=!c&&y<=p.maxRetries,u&&(v=u),f.close(e,n),s){var l={code:e,reason:n,wasClean:!0};D(),f.removeEventListener("close",D),Array.isArray(h.close)&&h.close.forEach(function(e){var n=e[0],o=e[1];n(l),f.removeEventListener("close",n,o)}),f.onclose&&(E=f.onclose,f.onclose(l),f.onclose=null)}},this.send=function(e){f.send(e)},this.addEventListener=function(e,n,o){Array.isArray(h[e])?h[e].some(function(e){return e[0]===n})||h[e].push([n,o]):h[e]=[[n,o]],f.addEventListener(e,n,o)},this.removeEventListener=function(e,n,o){Array.isArray(h[e])&&(h[e]=h[e].filter(function(e){return e[0]!==n})),f.removeEventListener(e,n,o)}};return l});